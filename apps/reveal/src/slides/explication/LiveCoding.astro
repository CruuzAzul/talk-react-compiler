---
import Slide from "../../components/Slide.astro";
import SlideTitle from "../../components/SlideTitle.astro";
---

<Slide>
	<Slide>
		<SlideTitle
			title="Pour faire simple, le React Compiler il fait quoi ?"
			punctuation="?"
			style={{
				margin: "auto",
				fontSize: "3rem",
				fontWeight: "bolder",
			}}
		/>
	</Slide>
	<Slide>
  <pre class="code-demo" data-id="code-animation">
		<code data-trim data-line-numbers>
			{`
				function TodoList({ visibility, themeColor }) {
					const [todos, setTodos] = useState(initialTodos);
					const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));
					const filteredTodos = getFiltered(todos, visibility);

					return (
						<div>
							<ul>
								{filteredTodos.map((todo) => (
									<Todo key={todo.id} todo={todo} onChange={handleChange} />
								))}
							</ul>
							<AddTodo setTodos={setTodos} themeColor={themeColor} />
						</div>
					);
				}
			`}
		</code>
	</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged;

						const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));

						const filteredTodos = getFiltered(todos, visibility);

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers="4, 8-10">
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged;

						const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));

						if (hasVisibilityChanged || hasTodosChanged) {
							const filteredTodos = getFiltered(todos, visibility);
						}

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged;

						const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));

						let filteredTodos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = getFiltered(todos, visibility);
						} else {
							filteredTodos = ????
						}

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers="4">
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));

						let filteredTodos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = getFiltered(todos, visibility);
						} else {
							filteredTodos = ????
						}

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers="8-13">
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						const handleChange = (todo) => setTodos(todos => getUpdated(todos, todo));

						let filteredTodos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = memoCache[1] = getFiltered(todos, visibility);
						} else {
							filteredTodos = memoCache[1];
						}

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers="6-8" style={{fontSize: "0.7rem", lineHeight: "1.3rem"}}>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						const handleChange =
							memoCache[0] ||
							(memoCache[0] = (todo) => setTodos(todos => getUpdated(todos, todo)));

						let filteredTodos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = memoCache[1] = getFiltered(todos, visibility);
						} else {
							filteredTodos = memoCache[1];
						}

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								<AddTodo setTodos={setTodos} themeColor={themeColor} />
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers style={{fontSize: "0.7rem", lineHeight: "1.3rem"}}>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						const handleChange =
							memoCache[0] ||
							(memoCache[0] = (todo) => setTodos(todos => getUpdated(todos, todo)));

						let filteredTodos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = memoCache[1] = getFiltered(todos, visibility);
						} else {
							filteredTodos = memoCache[1];
						}

						const jsx_addTodo = hasThemeColorChanged
						? (memoCache[3] = <AddTodo setTodos={setTodos} themeColor={themeColor} />)
						: memoCache[3];

						return (
							<div>
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
								{jsx_addTodo}
							</div>
						);
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers style={{fontSize: "0.7rem", lineHeight: "1.3rem"}}>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						const handleChange =
							memoCache[0] ||
							(memoCache[0] = (todo) => setTodos(todos => getUpdated(todos, todo)));

						let filteredTodos, jsx_todos;
						if (hasVisibilityChanged || hasTodosChanged) {
							filteredTodos = memoCache[1] = getFiltered(todos, visibility);
							jsx_todos = memoCache[2] = (
								<ul>
									{filteredTodos.map((todo) => (
										<Todo key={todo.id} todo={todo} onChange={handleChange} />
									))}
								</ul>
							);
						} else {
							filteredTodos = memoCache[1];
							jsx_todos = memoCache[2];
						}

						const jsx_addTodo = hasThemeColorChanged
						? (memoCache[3] = <AddTodo setTodos={setTodos} themeColor={themeColor} />)
						: memoCache[3];

						return <div>{jsx_todos}{jsx_addTodo}</div>;
					}
				`}
			</code>
		</pre>
	</Slide>
	<Slide>
		<pre class="code-demo" data-id="code-animation">
			<code data-trim data-line-numbers style={{fontSize: "0.7rem", lineHeight: "1.3rem"}}>
				{`
					function TodoList({ visibility, themeColor }) {
						const [todos, setTodos] = useState(initialTodos);

						let hasVisibilityChanged, hasThemeColorChanged, hasTodosChanged, memoCache;

						if (hasVisibilityChanged || hasThemeColorChanged || hasTodosChanged) {
							const handleChange =
							memoCache[0] ||
							(memoCache[0] = (todo) => setTodos(todos => getUpdated(todos, todo)));

							let filteredTodos, jsx_todos;
							if (hasVisibilityChanged || hasTodosChanged) {
								filteredTodos = memoCache[1] = getFiltered(todos, visibility);
								jsx_todos = memoCache[2] = (<ul>{filteredTodos.map(...)}</ul>);
							} else {
								filteredTodos = memoCache[1];
								jsx_todos = memoCache[2];
							}

							const jsx_addTodo = hasThemeColorChanged
							? (memoCache[3] = <AddTodo setTodos={setTodos} themeColor={themeColor} />)
							: memoCache[3];

							return (memoCache[4] = <div>{jsx_todos}{jsx_addTodo}</div>);
						} else {
							return memoCache[4];
						}
					}
				`}
			</code>
		</pre>
	</Slide>
</Slide>

<style>
	.code-demo {
		position: absolute;
		left: -50px;
	}
</style>
